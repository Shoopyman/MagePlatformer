extends Node2D

#Credit goes to https://www.youtube.com/watch?v=lhrqsUZ45j8&t=1302s


const in_edit_mode: bool = false
var current_level_name = "Forest_Boss1"

var fk_fall_time: float = 1.85
var fk_output_arr = [[], [], [], []]

var level_info = {
	"PROI_PROI" = {
		"fk_times": "[[4.77866678237915, 7.16800003051758, 9.23733310699463, 10.9440000534058, 13.0240009307861, 15.2640007019043, 16.4159992218018, 19.1999996185303, 19.9786670684814, 24.2133338928223, 25.9733341217041, 31.0826652526855, 32.1279991149902, 34.1759994506836, 35.5093315124512, 35.8826683044434, 36.223999786377, 36.5973327636719, 40.2026679992676, 41.9626663208008, 44.1066673278809, 45.333332824707, 46.5386665344238, 48.9173324584961, 49.9520004272461, 50.6880004882812, 51.4026649475098, 54.4959991455078, 56.0533340454102, 57.3973320007324, 59.9040000915527, 63.1679962158203, 65.0133331298828, 66.9333312988281, 69.83466796875, 71.9573333740234, 73.5040023803711, 75.0613296508789, 76.6186645507812, 78.0373352050781, 79.850666809082, 81.2160003662109, 82.8693359375, 84.1493347167969, 87.3813369750977, 88.6399963378906, 92.3413360595703, 94.8053329467773, 96.4800003051758, 97.1733367919922, 97.7706649780273, 98.6453369140625, 100.063999938965, 101.173336791992, 102.495999145508, 103.349331665039, 104.181332397461, 105.023999023438, 105.54666595459, 106.399998474121, 107.722668457031, 109.696003723145, 110.911999511719, 112.394665527344, 113.013333129883, 114.549336242676, 116.330670166016, 117.632000732422, 119.093334960938, 120.725331115723, 121.493336486816, 122.410664367676, 123.050663757324, 123.925335693359, 125.194668579102, 126.240002441406, 127.872006225586, 129.749340820313, 131.498669433594, 132.544003295898, 134.773327636719, 135.872006225586, 137.39733581543, 149.247998046875, 150.975994873047, 151.701336669922, 152.831997680664, 153.450665283203, 154.13332824707, 154.933331298828, 156.021328735352, 156.831997680664, 157.69599609375, 158.7306640625, 159.669338989258, 160.629330444336, 161.365338134766, 162.421337890625, 163.797329711914, 165.887997436523, 166.773327636719, 168.522671508789, 169.653332519531, 171.072003173828, 172.415997314453, 173.152005004883, 174.666668701172, 175.893338012695, 176.181332397461, 176.50133972168, 176.725338745117, 177.37600402832, 178.549328613281, 179.520001220703, 180.330670166016, 181.130673217773, 181.514660644531, 182.176007080078, 183.253338623047, 184.8, 186.453335571289, 188.22399597168, 189.045330810547, 190.495999145508, 192.415997314453, 196.266659545898, 197.83466796875, 200.34133605957, 202.335995483398, 203.818661499023, 204.853329467773, 205.738659667969, 206.538662719727, 208.138668823242, 209.653332519531, 211.18932800293, 212.768002319336, 214.837338256836, 216.490673828125, 217.919995117188, 220.586666870117, 224.554669189453, 226.485333251953], [5.50400047302246, 6.58133296966553, 8.66133289337158, 10.3786666870117, 12.4693334579468, 14.9546669006348, 16.1386669158936, 16.778666305542, 17.5786674499512, 18.5813339233398, 20.5973327636719, 23.893334197998, 25.5253341674805, 26.5493324279785, 27.274666595459, 31.0826652526855, 31.8293350219727, 33.0986679077148, 33.6213348388672, 37.7813346862793, 38.2293327331543, 38.826668548584, 39.1786659240723, 39.6800010681152, 40.6506660461426, 41.5253341674805, 42.3999984741211, 43.4453323364258, 43.6053321838379, 43.776001739502, 44.9279983520508, 46.1120002746582, 47.4986656188965, 49.1839988708496, 49.792000579834, 50.5173347473145, 51.2426651000977, 52.2346656799316, 52.7679985046387, 55.1680000305176, 57.1946647644043, 58.4746673583984, 59.5306671142578, 62.3253295898437, 64.3626678466797, 65.5040023803711, 66.4533355712891, 67.7226684570312, 68.9066665649414, 70.5386703491211, 71.5413330078125, 72.3733337402344, 73.2160003662109, 74.0906646728516, 74.8053329467773, 75.6906631469727, 76.4480026245117, 76.9493301391602, 77.6000030517578, 78.5493362426758, 79.3493316650391, 80.2453353881836, 80.885334777832, 81.7706649780273, 82.5493362426758, 83.2533309936523, 83.9679992675781, 84.4693344116211, 85.2693298339844, 85.6639984130859, 86.0480010986328, 86.4640014648437, 86.9653366088867, 87.7333343505859, 89.0559967041016, 91.8080032348633, 92.7786682128906, 93.7280014038086, 95.4240005493164, 96.0426681518555, 96.9813354492187, 97.5466659545898, 98.4320037841797, 98.9013336181641, 99.6479995727539, 100.394665527344, 100.927998352051, 102.165333557129, 103.072003173828, 103.946667480469, 104.8, 105.418667602539, 106.175999450684, 107.274670410156, 108.128002929688, 109.343998718262, 110.474667358398, 112.181332397461, 112.874668884277, 114.14400177002, 115.946667480469, 117.247998046875, 118.847996520996, 120.448002624512, 121.493336486816, 121.696003723145, 122.079998779297, 123.658665466309, 124.863995361328, 125.984005737305, 126.485333251953, 127.551998901367, 128.213330078125, 129.365338134766, 130.143994140625, 130.8693359375, 132.191998291016, 133.717327880859, 134.773327636719, 135.498669433594, 136.917340087891, 138.346661376953, 139.402661132813, 141.034664916992, 141.951992797852, 142.7306640625, 143.498669433594, 144.426663208008, 145.173336791992, 146.229336547852, 147.050671386719, 147.893338012695, 148.682659912109, 162.666668701172, 163.296002197266, 164.170666503906, 165.642666625977, 166.176007080078, 166.559994506836, 166.986660766602, 167.797329711914, 168.917340087891, 169.429333496094, 169.877331542969, 170.624005126953, 171.733334350586, 172.618664550781, 173.621334838867, 174.346661376953, 175.018673706055, 175.530667114258, 176.021328735352, 176.352001953125, 176.650662231445, 177.247998046875, 177.546673583984, 178.367993164063, 178.751995849609, 179.232006835938, 179.925335693359, 180.128002929688, 180.8, 181.674664306641, 182.325329589844, 183.050671386719, 183.615994262695, 184.373333740234, 185.344006347656, 186.048001098633, 186.997326660156, 187.893338012695, 189.173336791992, 189.97333984375, 190.975994873047, 191.882672119141, 192.970669555664, 194.250668334961, 196.650662231445, 197.418667602539, 198.538662719727, 199.893338012695, 200.768002319336, 201.83466796875, 202.688000488281, 203.541333007813, 204.565335083008, 205.141339111328, 206.27200012207, 206.794659423828, 207.872006225586, 208.383999633789, 209.290661621094, 210.069332885742, 210.837338256836, 211.573330688477, 212.415997314453, 213.184002685547, 214.29333190918, 215.296002197266, 216.138668823242, 216.842663574219, 217.39797668457, 218.250668334961, 220.042660522461, 221.141339111328, 221.706661987305, 222.677334594727, 223.285336303711, 223.90400390625, 225.962673950195, 227.658673095703, 228.277340698242], [], [5.95200042724609, 7.86133365631104, 9.79199962615967, 11.9573333740234, 13.5893333435059, 15.5733325958252, 16.0746658325195, 17.5786674499512, 19.4666660308838, 24.8960006713867, 31.0826652526855, 32.5760009765625, 34.5280006408691, 36.9599998474121, 37.4080017089844, 41.0453346252441, 42.8053329467773, 44.5013320922852, 45.6959999084473, 46.9653327941895, 47.9679992675781, 49.4186676025391, 50.2186668395996, 50.9866683959961, 51.7440002441406, 54.8480003356934, 56.9706657409668, 59.0293319702148, 61.3973358154297, 63.9146697998047, 66.0906646728516, 68.0639999389648, 71.0720031738281, 72.853337097168, 74.4426696777344, 76.0533340454102, 77.301335144043, 79.0720031738281, 80.5333297729492, 82.1866653442383, 83.5733306884766, 84.853337097168, 88.0533340454102, 90.0266693115234, 90.6239974975586, 91.3386657714844, 93.2053344726562, 95.6906631469727, 96.7573364257812, 97.4186676025391, 97.5466659545898, 98.1653335571289, 99.2000015258789, 100.65066986084, 101.802670288086, 102.815998840332, 103.701336669922, 104.469334411621, 105.301335144043, 105.994664001465, 106.794667053223, 108.501332092285, 110.101330566406, 111.999996948242, 112.757336425781, 113.461331176758, 113.781330871582, 115.093334960938, 116.778668212891, 118.399998474121, 120.05333404541, 121.098667907715, 122.7306640625, 123.381336975098, 124.224003601074, 125.621334838867, 126.965328979492, 128.821331787109, 130.495999145508, 131.786663818359, 133.002667236328, 135.093334960938, 136.266659545898, 137.83466796875, 150.048001098633, 151.32799987793, 152.50133972168, 153.152005004883, 153.770672607422, 154.495999145508, 155.44533996582, 156.330670166016, 157.301327514648, 158.069332885742, 159.125332641602, 160.170666503906, 161.002667236328, 161.97333984375, 162.922665405273, 164.597332763672, 165.25866394043, 166.357327270508, 167.381329345703, 169.173336791992, 170.27200012207, 172.117337036133, 172.863995361328, 173.930661010742, 175.199993896484, 177.002667236328, 178.079998779297, 179.072003173828, 179.914669799805, 180.693325805664, 181.802670288086, 182.464001464844, 182.880001831055, 183.882672119141, 185.69599609375, 187.370663452148, 189.439999389648, 191.423992919922, 193.653332519531, 197.045330810547, 199.44533996582, 201.184002685547, 203.221340942383, 204.266659545898, 205.450665283203, 206.016003417969, 207.498669433594, 208.746670532227, 210.464001464844, 211.967999267578, 213.919995117188, 215.722668457031, 217.141339111328, 219.285336303711, 225.077328491211, 227.093334960938]]
",
		"music": load("res://art/PLACEHOLDER/49. Proi Proi.wav")
	},
	"TEST_MUSIC" = {
		"fk_times": "[[-2.32539684772491, -0.54414958953857, 2.45301609039307, 4.04226760864258, 5.77018146514893, 7.30609970092773, 8.650022315979, 10.2926080703735, 11.7431972503662, 13.0444667816162, 14.2710655212402, 15.5616558074951, 17.1935832977295, 18.7934921264648, 20.1267574310303, 21.8226535797119, 23.0599315643311, 24.8198421478271, 26.5050800323486], [-1.8240816116333, -1.02412695884705, 0.2664626121521, 1.90904741287231, 2.85834484100342, 3.7756236076355, 4.4262583732605, 5.24755077362061, 6.30349235534668, 6.84746055603027, 7.57274417877197, 8.24471645355225, 9.1406572341919, 9.97263031005859, 10.6659181594849, 11.4765537261963, 12.0738552093506, 12.8097961425781, 13.5031059265137, 14.0150802612305, 14.5483901977539, 15.252335357666, 15.9136512756348, 16.6602714538574, 17.7162139892578, 18.2815196990967, 19.0068023681641, 19.6574371337891, 20.4573925018311, 21.5773475646973, 22.0679824829102, 22.8252838134766, 23.4545810699463, 24.3185260772705, 25.2784812927246, 26.1744220733643, 26.8250568389893], [], [-1.45077092647553, 0.87444429397583, 3.50895671844482, 4.91689376831055, 6.60213165283203, 7.77539710998535, 9.449977684021, 11.0178907394409, 12.2978227615356, 13.7057598114014, 14.9643543243408, 16.3082759857178, 18.0148532867432, 19.2414730072021, 20.9373691558838, 22.5692966461182, 23.9558723449707, 25.5984580993652, 27.2517002105713]]
",
		"music": load("res://Sound/Music/TEST_MUSIC.wav")
	},
	"Forest_Boss1" = {
		"fk_times": "[[13.2545808792114, 14.4823364257813, 20.7546257019043, 25.7556232452393, 27.0036968231201, 32.0192054748535, 35.7634223937988, 37.0318130493164, 42.064737701416, 42.6742614746094, 44.540567779541, 45.0107711791992, 45.4693664550781, 49.5763954162598, 50.0117668151855, 50.4500450134277, 55.7499984741211, 59.473902130127, 63.8682769775391, 65.1366638183594, 65.4153045654297, 65.74619140625, 66.0538543701172, 66.3847412109375, 66.7156204223633, 71.6759857177734, 72.8805221557617, 73.211408996582, 73.5974411010742, 73.9370330810547, 74.227278137207, 78.2472366333008, 78.5665115356445, 78.8770736694336, 79.1760314941406, 79.5156234741211, 79.8261932373047, 80.1338562011719, 80.4241012573242, 81.7244247436523, 82.9405654907227, 85.7792037963867, 86.6528533935547, 87.0040573120117, 87.4307235717773, 87.9125427246094, 91.9847396850586, 92.5071853637695, 92.9454635620117, 95.7724975585938, 96.689680480957, 97.0002502441406, 97.4907745361328, 97.9261459350586, 98.2483200073242, 99.1742156982422, 99.5283187866211, 99.9869140625, 100.42229309082, 108.2212890625, 109.147184753418, 109.457754516602, 110.418478393555, 110.737753295898, 111.64333190918, 111.985830688477, 112.914625549316, 114.21494140625, 115.463018798828, 115.761968994141, 117.021658325195, 118.246504211426, 123.270727539063, 125.76686706543, 127.046865844727, 127.525778198242, 127.932135009766], [18.2381633758545, 19.4949440002441, 21.4047836303711, 28.2314514160156, 29.4592060089111, 31.3777565002441, 32.6142181396484, 38.216032409668, 39.4960311889648, 41.4465087890625, 42.3753074645996, 42.9616111755371, 45.7683204650879, 46.6419738769531, 47.0367111206055, 47.5156234741211, 47.9422897338867, 52.0086845397949, 52.475984954834, 52.8823341369629, 58.2461456298828, 62.9626983642578, 63.6012481689453, 64.1788467407227, 64.8057846069336, 66.9826568603516, 67.3019241333008, 67.6241058349609, 67.9317687988281, 70.7791122436523, 71.388639831543, 71.9546264648438, 72.5409301757813, 74.5030120849609, 74.8222869873047, 75.1647857666016, 75.4318145751953, 76.9991592407227, 77.3097290039063, 77.6057800292969, 77.927961730957, 80.743376159668, 81.3732208251953, 82.0030578613281, 82.6300033569336, 84.50791015625, 84.9578002929688, 85.4483245849609, 88.2405227661133, 89.1257843017578, 90.7685913085938, 91.6451477050781, 93.276350402832, 94.1819290161133, 94.5244201660156, 95.0033325195313, 95.45322265625, 95.7724975585938, 96.678076171875, 97.0002502441406, 97.4907745361328, 97.9261459350586, 100.753172302246, 101.68197479248, 102.001249694824, 102.514990234375, 102.930044555664, 113.254217529297, 113.895666503906, 114.513899230957, 115.152449035645, 116.092855834961, 116.722700500488, 117.329321289063, 117.938841247559, 118.577391052246, 119.207235717773, 119.837072753906, 120.48723449707, 121.053221130371, 121.691770935059, 123.920881652832, 125.137030029297], [], [15.7304080963135, 16.958162689209, 21.9591602325439, 22.6209300994873, 24.466915512085, 30.7275947570801, 33.2672790527344, 34.5153526306152, 40.7324928283691, 43.2402481079102, 43.7394775390625, 44.2300018310547, 48.2847846984863, 48.7317680358887, 49.2019714355469, 50.7373908996582, 51.219206237793, 51.654581451416, 53.2219261169434, 60.7219718933105, 61.0644668579102, 61.6914047241211, 63.2819732666016, 64.4777969360352, 68.2423385620117, 68.5732177734375, 68.8721755981445, 69.1914505004883, 69.4991134643555, 69.8300003051758, 70.1521743774414, 70.4279159545898, 71.0461486816406, 72.2419723510742, 75.7191604614258, 76.0616516113281, 76.4012435913086, 76.6798843383789, 81.0858749389648, 82.2904113769531, 83.2511352539063, 84.0928558349609, 89.4682754516602, 89.9704116821289, 90.4609283447266, 93.276350402832, 94.1819290161133, 94.5244201660156, 94.9946273803711, 95.4416107177734, 98.2483200073242, 99.1742156982422, 99.5283187866211, 99.975309753418, 100.433897399902, 103.313177490234, 104.157797241211, 104.485784912109, 105.437803649902, 105.765783691406, 106.706190490723, 106.993536376953, 107.922338867188, 113.509634399414, 114.801245117188, 116.400518798828, 117.639883422852, 118.88796081543, 119.517797851563, 120.15634765625, 120.797804260254, 121.372496032715, 121.990728759766, 122.321607971191, 122.632177734375, 122.939840698242, 124.518797302246]]
",
		"music": load("res://Sound/Music/forestBoss.mp3")
	}
}


func _ready()->void:
	
	$MusicPlayer.stream=level_info.get(current_level_name).get("music")
	$MusicPlayer.play()
	
	if in_edit_mode:
		print("GOOD")
		Signals.KeyListenerPress.connect(KeyListenerPress)
	else:
		var fk_times = level_info.get(current_level_name).get("fk_times")
		var fk_times_arr = str_to_var(fk_times)
		print(fk_times_arr[0])
		
		var counter: int = 0
		for key in fk_times_arr:
			
			var button_name: String = ""
			match counter:
				0:
					button_name = "left"
				1: 
					button_name = "down"
				3:
					button_name = "right"
			
			for delay in key:
				SpawnFallingKey(button_name, delay)
			counter += 1

func KeyListenerPress(_button_name: String, array_num: int):
	print(str(array_num) + " " + str($MusicPlayer.get_playback_position()))
	fk_output_arr[array_num].append($MusicPlayer.get_playback_position() - fk_fall_time)

func SpawnFallingKey(button_name: String, delay: float):
	await get_tree().create_timer(delay).timeout
	Signals.CreateFallingKey.emit(button_name)


func _on_music_player_finished() -> void:
	if(in_edit_mode):
		print(fk_output_arr)
	else:
		get_tree().change_scene_to_file("res://Scenes/Main Menu/main_menu.tscn")
